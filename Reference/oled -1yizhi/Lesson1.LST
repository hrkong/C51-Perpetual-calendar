C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE LESSON1
OBJECT MODULE PLACED IN Lesson1.OBJ
COMPILER INVOKED BY: D:\keil 4\C51\BIN\C51.EXE Lesson1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //51µ¥Æ¬»ú¿ØÖÆÎÂÊª¶È´«¸ÐÆ÷DHT11ª£È»ºóÔÚLCD1602ÉÏÏÔÊ¾µ±Ç°µÄÎÂÊª¶È¼°µ¥Î»ª£ÆäÖÐÊª¶ÈÔÚµÚÒ»ÐÐÏÔÊ¾ª£ÎÂ¶ÈÔÚµÚ¶þÐÐ
             -ÏÔÊ¾¡£µ¥Æ¬»úÎªYL-9×îÐ¡ÏµÍ³¡£
   2          
   3          
   4          # include <reg52.h>
   5          # include <intrins.h>
   6          typedef unsigned char BYTE;
   7          typedef unsigned int WORD;
   8          #define uint unsigned int 
   9          #define uchar unsigned char 
  10          sbit io=P3^6;//dht11data¶Ë½Óµ¥Æ¬»úµÄP1^0¿Ú// 
  11          
  12          sbit rw=P2^5;//Ò»ÏÂÈýÐÐÊÇÉèÖÃlcd1602µÄÊ¹ÄÜ¶Ë// 
  13          
  14          sbit rs=P2^6; 
  15          
  16          sbit ep=P2^7; 
  17          
  18          typedef bit BOOL;//´ËÉùÃ÷Ò»¸ö²¼¶ûÐÍ±äÁ¿¼´Õæ»ò¼Ù// 
  19          
  20          uchar data_byte; 
  21          
  22          uchar RH,RL,TH,TL; 
  23          
  24           
  25          
  26          //***************ÑÓÊ±º¯Êý************************************* 
  27          
  28           void delay(uchar ms) //ÑÓÊ±Ä£¿é// 
  29          
  30          { 
  31   1      
  32   1        uchar i; 
  33   1      
  34   1        while(ms--)                 
  35   1      
  36   1              
  37   1      
  38   1       for(i=0;i<100;i++); 
  39   1      
  40   1      } 
  41          
  42          
  43          void delay1()//Ò»¸öforÑ­»·´ó¸ÅÐèÒª8¸ö¶à»úÆ÷ÖÜÆÚª£Ò»¸ö»úÆ÷ÖÜÆÚÎª1usª¡¾§ÕñÎª12MHzª¢ª£Ò²¾ÍÊÇËµ±¾º¯ÊýÑÓÊ±8us¶à
             -ª¡´ËÑÓÊ±º¯Êý±ØÐëµÂÉÔÎ¢¾«È·Ò»µãª¢ 
  44          
  45          { 
  46   1      
  47   1        uchar i; 
  48   1      
  49   1        for(i=0;i<1;i++); 
  50   1      
  51   1      } 
  52          
  53            
C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 2   

  54          
  55          //***************************************************************  
  56          
  57          //lcdÄ£¿é// 
  58          
  59          BOOL lcd_bz()//²âÊÔlcdÃ¦Âµ×´Ì¬ª£·µ»ØÖµÎª²¼¶ûÐÍÊýÖµª£Õæ»ò¼Ùª¡'1'.'0'ª¢  
  60          
  61          { 
  62   1      
  63   1       BOOL result;
  64   1        rs=0;           // ¶ÁÃ¦ÐÅºÅ
  65   1        rw=1;
  66   1        ep=1;
  67   1        _nop_();
  68   1        _nop_();
  69   1        _nop_();
  70   1        _nop_();
  71   1        result = (BOOL)(P0&0x80);
  72   1        ep=0;
  73   1        result ;
*** WARNING C275 IN LINE 73 OF LESSON1.C: expression with possibly no effect
  74   1      
  75   1      }     
*** WARNING C173 IN LINE 75 OF LESSON1.C: missing return-expression
  76          
  77          void write_cmd(uchar cmd)//Ð´Ö¸Áî// 
  78          
  79          { 
  80   1      
  81   1        while (lcd_bz());
  82   1        rs=0;
  83   1        rw=0;
  84   1        ep=0;
  85   1        _nop_();
  86   1        _nop_();
  87   1        P0=cmd ;
  88   1        _nop_();
  89   1        _nop_();
  90   1        _nop_();
  91   1        _nop_();
  92   1        ep=1;
  93   1        _nop_();
  94   1        _nop_();
  95   1        _nop_();
  96   1        _nop_();
  97   1        ep=0;
  98   1      
  99   1      } 
 100          
 101           
 102          
 103          void write_addr(uchar addr)//Ð´µØÖ·// 
 104          
 105          { 
 106   1      
 107   1        write_cmd(addr|0x80);//LCDµÚÒ»ÐÐµÄÊ×µØÖ·Îª0x80ª¡µÚ¶þÐÐµÄÊ×µØÖ·Îª0x80+0x40=0xc0 
 108   1      
 109   1      } 
 110          
 111           
 112          
 113          void write_byte(uchar dat) //Ð´×Ö½Ú// 
C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 3   

 114          
 115          { 
 116   1      
 117   1         while (lcd_bz());
 118   1        rs=1;
 119   1        rw=0;
 120   1        ep=0;
 121   1        _nop_();
 122   1        _nop_();
 123   1        P0=dat ;
 124   1        _nop_();
 125   1        _nop_();
 126   1        _nop_();
 127   1        _nop_();
 128   1        ep=1;
 129   1        _nop_();
 130   1        _nop_();
 131   1        _nop_();
 132   1        _nop_();
 133   1        ep=0;
 134   1      
 135   1      } 
 136          
 137           
 138          
 139          void lcd_init() //lcd³õÊ¼»¯// 
 140          
 141          { 
 142   1      
 143   1        write_cmd(0x38);//ÉèÖÃLCDÁ½ÐÐÏÔÊ¾ª¡Ò»¸öÊý¾ÝÓÉ5*7µãÕó±íÊ¾,Êý¾ÝÓÉ8¸úÏß´«Êä 
 144   1      
 145   1        delay(1); 
 146   1      
 147   1        write_cmd(0x0c);//Çå³ýÆÁÄ»ÏÔÊ¾ 
 148   1      
 149   1        delay(1); 
 150   1      
 151   1        write_cmd(0x06);//Éè¶¨ÊäÈë·½Ê½ª¡ÔöÁ¿²»ÒÆÎ» 
 152   1      
 153   1        delay(1); 
 154   1      
 155   1        write_cmd(0x01);//¿ªÕûÌåÏÔÊ¾ª¡¹Ø¹â±êª¡²»ÉÁË¸ 
 156   1      
 157   1        delay(1); 
 158   1      
 159   1      } 
 160          
 161           
 162          
 163          void display(uchar addr,uchar q)//ÔÚÄ³Ò»µØÖ·ÉÏÏÔÊ¾ÄÚÈÝª¡adder±íÊ¾µÄÊÇµØÖ·Æ«ÒÆÁ¿ª¡q±íÊ¾ÏÔÊ¾µÄ×Ö·û»òÊý×Ö// 
 164          
 165          { 
 166   1      
 167   1        delay(10);   write_addr(addr); 
 168   1      
 169   1        write_byte(q); 
 170   1      
 171   1        delay(1);//ÐÞ¸Ä´ËÊ±¼äª£¿ÉÒÔ¸Ä±äLCDÉÏÊýÖµÌø±äµÄÊý¶È 
 172   1      
 173   1      } 
 174          
 175           
C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 4   

 176          
 177          //**************************dht11²âÊÔÄ³¿é*************************************// 
 178          
 179          void start()//¿ªÊ¼ÐÅºÅ 
 180          
 181          { 
 182   1      
 183   1        io=1; 
 184   1      
 185   1        delay1(); 
 186   1      
 187   1        io=0; 
 188   1      
 189   1        delay(25);// Ö÷»ú°Ñ×ÜÏßÀ­µÍ±ØÐë´óÓÚ18msª£±£Ö¤DHT11ÄÜ¼ì²âµ½ÆðÊ¼ÐÅºÅ 
 190   1      
 191   1        io=1;    //·¢ËÍ¿ªÊ¼ÐÅºÅ½áÊøºóª£À­¸ßµçÆ½ÑÓÊ±20-40us 
 192   1      
 193   1        delay1();//ÒÔÏÂÈý¸öÑÓÊ±º¯Êý²î²»¶àÎª24usª£·ûºÏÒªÇó 
 194   1      
 195   1        delay1(); 
 196   1      
 197   1        delay1(); 
 198   1      
 199   1      } 
 200          
 201           
 202          
 203          uchar receive_byte()//½ÓÊÕÒ»¸ö×Ö½Ú// 
 204          
 205          { 
 206   1      
 207   1        uchar i,temp; 
 208   1      
 209   1        for(i=0;i<8;i++)//½ÓÊÕ8bitµÄÊý¾Ý 
 210   1      
 211   1        { 
 212   2      
 213   2              while(!io);//µÈ´ý50usµÄµÍµçÆ½¿ªÊ¼ÐÅºÅ½áÊø 
 214   2      
 215   2              delay1();//¿ªÊ¼ÐÅºÅ½áÊøÖ®ºóª£ÑÓÊ±26us-28usª¡ÒÔÏÂÈý¸öÑÓÊ±º¯Êýª¢ 
 216   2      
 217   2               delay1(); 
 218   2      
 219   2              delay1(); 
 220   2      
 221   2              temp=0;//Ê±¼äÎª26us-28usª£±íÊ¾½ÓÊÕµÄÎªÊý¾Ý'0' 
 222   2      
 223   2              if(io==1) 
 224   2      
 225   2               temp=1; //Èç¹û26us-28usÖ®ºóª£»¹Îª¸ßµçÆ½ª£Ôò±íÊ¾½ÓÊÕµÄÊý¾ÝÎª'1' 
 226   2      
 227   2          while(io);//µÈ´ýÊý¾ÝÐÅºÅ¸ßµçÆ½ª¡'0'Îª26us-28usª£'1'Îª70usª¢ 
 228   2      
 229   2              data_byte<<=1;//½ÓÊÕµÄÊý¾ÝÎª¸ßÎ»ÔÚÇ°ª¡ÓÒÒÆª¢ 
 230   2      
 231   2               data_byte|=temp; 
 232   2      
 233   2        } 
 234   1      
 235   1        return data_byte; 
 236   1      
 237   1      } 
C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 5   

 238          
 239              
 240          
 241          void receive()//½ÓÊÕÊý¾Ý// 
 242          
 243          { 
 244   1      
 245   1        uchar T_H,T_L,R_H,R_L,check,num_check,i; 
 246   1      
 247   1        start();//¿ªÊ¼ÐÅºÅ// 
 248   1      
 249   1        io=1;   //Ö÷»úÉèÎªÊäÈëª£ÅÐ¶Ï´Ó»úª¡DHT11ª¢ÏìÓ¦ÐÅºÅ 
 250   1      
 251   1        if(!io)//ÅÐ¶Ï´Ó»úÊÇ·ñÓÐµÍµçÆ½ÏìÓ¦ÐÅºÅ// 
 252   1      
 253   1        {  
 254   2              while(!io);//ÅÐ¶Ï´Ó»ú·¢³ö 80us µÄµÍµçÆ½ÏìÓ¦ÐÅºÅÊÇ·ñ½áÊø// 
 255   2      
 256   2              while(io);//ÅÐ¶Ï´Ó»ú·¢³ö 80us µÄ¸ßµçÆ½ÊÇ·ñ½áÊøª£Èç½áÊøÔòÖ÷»ú½øÈëÊý¾Ý½ÓÊÕ×´Ì¬ 
 257   2      
 258   2              R_H=receive_byte();//Êª¶È¸ßÎ» 
 259   2      
 260   2              R_L=receive_byte();//Êª¶ÈµÍÎ» 
 261   2      
 262   2              T_H=receive_byte();//ÎÂ¶È¸ßÎ» 
 263   2      
 264   2              T_L=receive_byte();//ÎÂ¶ÈµÍÎ» 
 265   2      
 266   2              check=receive_byte();//Ð£ÑéÎ» 
 267   2      
 268   2              io=0; //µ±×îºóÒ»bitÊý¾Ý½ÓÍê±Ïºóª£´Ó»úÀ­µÍµçÆ½50us// 
 269   2      
 270   2              for(i=0;i<7;i++)//²î²»¶à50usµÄÑÓÊ± 
 271   2      
 272   2              delay1(); 
 273   2      
 274   2              io=1;//×ÜÏßÓÉÉÏÀ­µç×èÀ­¸ßª£½øÈë¿ÕÏÐ×´Ì¬ 
 275   2      
 276   2              num_check=R_H+R_L+T_H+T_L; 
 277   2      
 278   2              if(num_check==check)//ÅÐ¶Ï¶Áµ½µÄËÄ¸öÊý¾ÝÖ®ºÍÊÇ·ñÓëÐ£ÑéÎ»ÏàÍ¬ 
 279   2      
 280   2              { 
 281   3      
 282   3         RH=R_H; 
 283   3      
 284   3         RL=R_L; 
 285   3      
 286   3         TH=T_H; 
 287   3      
 288   3         TL=T_L; 
 289   3      
 290   3         check=num_check; 
 291   3      
 292   3              } 
 293   2      
 294   2        } 
 295   1      
 296   1      } 
 297          
 298          //*****************************************************************************
 299          
C51 COMPILER V9.00   LESSON1                                                               04/23/2022 14:56:06 PAGE 6   

 300           
 301          
 302          void main()//Ö÷º¯ÊýÄ£¿é// 
 303          
 304          { 
 305   1      
 306   1        lcd_init();//³õÊ¼»¯LCD 
 307   1      
 308   1        while(1) 
 309   1      
 310   1        { 
 311   2      
 312   2          receive();//½ÓÊÕÊý¾Ý 
 313   2      
 314   2       display(0x00,'R');//LCDµÄµÚÒ»ÐÐÏÔÊ¾ 
 315   2      
 316   2       display(0x01,':'); 
 317   2      
 318   2       display(0x02,RH/10+0x30); //0x30±íÊ¾ª¤´ø×Ö¿âµÄLCD1602ÖÐ0x30µÄÎ»ÖÃ·ÅÓÐÊý×Ö0ª¡RH/10+0x30¼´±íÊ¾Êª¶ÈµÄÊ®Î»Êý×
             -ÖÔÚ×Ö¿âRH/10+0x30µÄÎ»ÖÃ´¦·Å×Åª¢ 
 319   2      
 320   2       display(0x03,RH%10+0x30); 
 321   2      
 322   2       display(0X04,'%'); 
 323   2      
 324   2       display(0x40,'T');//LCDµÄµÚ¶þÐÐÏÔÊ¾ 
 325   2      
 326   2       display(0x41,':'); 
 327   2      
 328   2       display(0x42,TH/10+0x30); 
 329   2      
 330   2       display(0x43,TH%10+0x30); 
 331   2      
 332   2       display(0x44,0xdf);//ÒÔÏÂÁ½¸öÊÇÎÂ¶Èµ¥Î»µÄ´¦Àí 
 333   2      
 334   2       display(0x45,0x43); 
 335   2      
 336   2        } 
 337   1      } 
 338          
 339          
 340          
 341          
 342          
 343          
*** WARNING C290 IN LINE 75 OF LESSON1.C: missing return value


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    403    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
